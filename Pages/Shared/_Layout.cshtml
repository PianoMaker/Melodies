@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    var currentPage = Context.Request.Path.Value ?? "";
    var currentCulture = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Melodies25</title>
    
    <!--BOOTSTRAP-->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />    
    <!--<link rel="stylesheet" href="~/css/assets.css" asp-append-version="true" />-->
    
    <!--GOOOOGLE-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Monsieur+La+Doulaise&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Pinyon+Script&family=Schibsted+Grotesk:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/singerella.css" asp-append-version="true" />     

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Schibsted+Grotesk:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">

    <!--GOOOOGLE-->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!--CUSTOM-->
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />    
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/contextMenu.css" asp-append-version="true" />

    @await RenderSectionAsync("Styles", required: false)


</head>
<body class="@ViewData["BodyClass"]">

    <!--Верхня панель-->
    <header >        
        <nav id="navbarstrip" class="navbar navbar-expand-md navbar-dark bg-sky border-bottom box-shadow p-0">
            <div id="navcontainer" class="container-fluid d-flex flex-nowrap align-items-start px-0 px-md-3">

                <!-- Лого + гамбургер в одному рядку -->
                <div id="logo&toggler" class="w-100" style="display:flex;flex-wrap:nowrap;align-items:center;">
                    <div id="logocontainer" class="flex-grow-1" style="display:flex;align-items:center;min-width:0;">
                        <!-- Логотип -->
                        <a class="navbar-brand imgcontainer me-2 p-0" asp-page="/Index">
                            <img src="~/images/Melody8.png" class="logoimage" alt="Melodies25 logo" />
                        </a>
                    </div>

                    <div id="togglecontainer" class="ms-auto" style="display:flex;align-items:center;flex:0 0 auto;">
                        <!-- Гамбургер праворуч (лише мобільна версія) -->
                        <button class="navbar-toggler d-md-none" type="button"
                                data-bs-toggle="collapse" data-bs-target="#mainNavbar"
                                aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                </div>

                <div id="mainNavbar" class="navbar-collapse collapse justify-content-between">
                    <ul class="navbar-nav flex-grow-1" style="padding:0; align-items: center;">
                        
                        <!--Мелодії-->
                        @if (currentPage.StartsWith("/Melodies"))
                        {
                            <li class="nav-item melodyitem active">
                                <a class="nav-link navmelody" asp-page="/Melodies/Index">@Localizer["Melodies"]</a>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item melodyitem">
                                <a class="nav-link navmelody" asp-page="/Melodies/Index">@Localizer["Melodies"]</a>
                            </li>
                        }
                        <!--Автори-->
                        @if (currentPage.StartsWith("/Authors"))
                        {
                            <li class="nav-item melodyitem active">
                                <a class="nav-link navmelody @(currentPage == "/Authors/Index" ? "active" : "")" asp-page="/Authors/Index">@Localizer["Authors"]</a>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item melodyitem">
                                <a class="nav-link navmelody @(currentPage == "/Authors/Index" ? "active" : "")" asp-page="/Authors/Index">@Localizer["Authors"]</a>
                            </li>
                        }
                        <!--Країни-->
                        @if (currentPage.StartsWith("/Countries"))
                        {
                            <li class="nav-item melodyitem active">
                                <a class="nav-link navmelody @(currentPage == "/Countries/Index" ? "active" : "")" asp-page="/Countries/Index">@Localizer["Countries"]</a>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item melodyitem">
                                <a class="nav-link navmelody @(currentPage == "/Countries/Index" ? "active" : "")" asp-page="/Countries/Index">@Localizer["Countries"]</a>
                            </li>
                        }
                        <!--Про сайт-->
                        @if (currentPage.StartsWith("/Privacy"))
                        {
                            <li class="nav-item melodyitem active">
                                <a class="nav-link navmelody" asp-area="" asp-page="/Privacy">@Localizer["About"]</a>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item melodyitem">
                                <a class="nav-link navmelody" asp-area="" asp-page="/Privacy">@Localizer["About"]</a>
                            </li>
                        }
                        <!-- Мова -->
                        <li class="nav-item d-flex align-items-center ms-md-2">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Language switcher">
                                <input type="radio" class="btn-check" name="culture-switch" id="langUk" value="uk" @(currentCulture == "uk" ? "checked" : null) />
                                <label class="btn @(currentCulture == "uk" ? "btn-pale" : "btn-outline-light")" for="langUk">УКР</label>
                                <input type="radio" class="btn-check" name="culture-switch" id="langEn" value="en" @(currentCulture == "en" ? "checked" : null) />
                                <label class="btn @(currentCulture == "en" ? "btn-pale" : "btn-outline-light")" for="langEn">EN</label>
                            </div>
                        </li>

                        <!--
                        Для адміністратора
                        -->                           
                        @if (User.IsInRole("Admin") || (User.IsInRole("Moderator")))
                        {
                            @* when in Account/Experimental/Admin *@
                            @if (currentPage.Contains("/Account") || currentPage.Contains("/Experimental") || currentPage.Contains("/Admin"))
                            {
                                <li class="nav-item melodyitem active">
                                    <a class="nav-link navmelody" style="width:100px" asp-page="/Account/Users">
                                        <i class="fa fa-cogs"></i>
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item melodyitem">
                                    <a class="nav-link navmelody" style="width:100px" asp-page="/Account/Users">
                                        <i class="fa fa-cogs"></i>
                                    </a>
                                </li>
                            }                           
                            
                        }
                        </ul>
                    
                </div>
                
            </div>
            
        </nav>
    </header>
    
    <!-- Середина -->
    
    @if (ViewContext.RouteData.Values["Page"]?.ToString() == "/Index")
    {
     <div class="mainpage">
        @RenderBody()
        </div>
    }
    else
    {
        <div class="container h-85">
            <main role="main" class="pb-3">
                @RenderBody()
            </main>
        </div>
    }

    <!-- Нижня панель -->
    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; pianomaker, 2025 <a asp-area="" asp-page="/Privacy"> -  About site</a>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/mobileMenu.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/vexflow.js"></script> <!-- ноти -->
    <script src="~/lib/midirender/midifile.bundle.js"></script> <!-- MIDI -->
    <script src="~/lib/midirender/mr-calculate-rows-helper.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/mr-key-signatures-helper.js" asp-append-version=" true"></script>
    <script src="~/lib/midirender/mr-durations-helper.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/mr-beams-helper.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/mr-svg-helper.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/mr-rests-helper.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/midiparser.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/midiparser_ext.js" asp-append-version="true"></script>
    <script src="~/lib/midirender/midiRenderer.js" asp-append-version="true"></script>  
    <script src="~/lib/midirender/patternRenderer.js" asp-append-version="true"></script> 
    <script src="~/js/admin-topbar.js" asp-append-version="true"></script>
    
    <script>
        (() => {
            const inputs = document.querySelectorAll('input[name="culture-switch"]');
            if (!inputs.length) return;

            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    const culture = input.value;
                    const cookieName = '.AspNetCore.Culture';
                    const cookieValue = `c=${culture}|uic=${culture}`;
                    const expires = new Date();
                    expires.setFullYear(expires.getFullYear() + 1);
                    document.cookie = `${cookieName}=${cookieValue}; expires=${expires.toUTCString()}; path=/`;
                    window.location.reload();
                });
            });
        })();
    </script>


    @* Render optional page-level Scripts section here *@
    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>