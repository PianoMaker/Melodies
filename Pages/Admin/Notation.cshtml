@page
@model Melodies25.Pages.Account.NotationModel
@{
}

@* Admin menu: show only to admins *@
@if (User.IsInRole("Admin"))
{
    @await Html.PartialAsync("_adminMenu")
}


<div class="infocontainer">
    <h2>Оберіть Midi-файл для відображення</h2>
    <form method="post">
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <button id="prevMidi" type="button">Previous</button>
            <select id="midifiles" asp-for="SelectedMidiFile">
                @foreach (var file in Model.MidiFiles)
                {
                    <option value="@file" data-id="@(Model.FileIds.TryGetValue(file!, out var id) ? id : -1)">@file</option>
                }
            </select>
            <button id="nextMidi" type="button">Next</button>
        </div>
        <div style="display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;">
            <button asp-page-handler="Check" type="submit">Check</button>
            <button asp-page-handler="AddEOF" type="submit">Add EOF</button>
            <button id="editMidi" type="button">Edit</button>
        </div>
    </form>
    <div style="text-align:center; margin-bottom:8px;">
        <input type="file" id="midiLocalFile" accept=".mid,.midi" />
    </div>

    <p> @Model.CheckMessage</p>


    <div class="notation-layout">
        <!-- НОТИ -->
        <div id="SheetMusic" class="panel-notes">
            <p style="text-align: center">Ноти</p>
            <div id="notation"></div>
            <div id="result"></div>
        </div>
        <!-- ПАНЕЛЬ ПРАВОРУЧ -->
        <div class="NotesList">
            <p style="text-align: center">Музичний розмір:</br> <span id="timesignature"></span></p>
            <p style="text-align: center">Тональність:</br> <span id="keysignatures"></span></p>
            <p style="text-align: center">Список нот</p>
            <div id="code" style="padding-left: 15px;"></div>
        </div>
    </div>
    <div id="comments"></div>
</div>
<script src="~/lib/midifile/midifile.bundle.js"></script> <!-- MIDI -->
<script type="module" src="~/js/formatMidiNotesForDisplay.js"></script> <!-- MIDI -->
<script src="~/lib/midirender/midifile.bundle.js"></script>
<script src="~/lib/midirender/vexflow.js"></script>
<script src="~/lib/midirender/midiparser.js"></script>
<script src="~/lib/midirender/midiparser_ext.js"></script>
<script src="~/lib/midirender/mr-beams-helper.js"></script>
<script src="~/lib/midirender/mr-calculate-rows-helper.js"></script>
<script src="~/lib/midirender/mr-durations-helper.js"></script>
<script src="~/lib/midirender/midiRenderer.js"></script>
<script type="module" src="~/js/NotationFetch.js"></script>





